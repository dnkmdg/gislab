//Randomly generated test-users from http://randomuser.me
var json_users = {
 "results": [{
   "user": {
     "gender": "female",
     "name": {
       "title": "mrs",
       "first": "claudia",
       "last": "weaver"
     },
     "location": {
       "street": "7642 sixth st",
       "city": "provo",
       "state": "oregon",
       "zip": "30032"
     },
     "email": "claudia.weaver74@example.com",
     "username": "beautifulgorilla6",
     "password": "ncc1701a",
     "salt": "sViMc5zL",
     "md5": "af50cab09477460f6edacbe32a6be7b5",
     "sha1": "9e33a9a6447ddc7f00782b8681be73dd949631b0",
     "sha256": "c7fd4cd696b86a3b24daf6198a02b3e8607d4860ad8071ea581ee3c34ab077ad",
     "registered": "1307792437",
     "dob": "95073693",
     "phone": "(539)-932-2121",
     "cell": "(832)-754-8903",
     "SSN": "594-82-1332",
     "picture": "http://api.randomuser.me/portraits/women/72.jpg"
   },
   "seed": "f7e7fc747743e8c",
   "version": "0.4"
 }, {
   "user": {
     "gender": "male",
     "name": {
       "title": "mr",
       "first": "patrick",
       "last": "ramirez"
     },
     "location": {
       "street": "1221 kelly dr",
       "city": "henderson",
       "state": "pennsylvania",
       "zip": "45751"
     },
     "email": "patrick.ramirez78@example.com",
     "username": "beautifuldog840",
     "password": "lisa",
     "salt": "luWo5Zzt",
     "md5": "094fb59163783e90c6faa888f1f9d913",
     "sha1": "66bae93aab3cf352c48adf923e58b3a45b8f18f9",
     "sha256": "a4685e8aafd5740ccc7d368c19695e2bf3a1e7d7d6469246c9b0f36760ae3950",
     "registered": "1209558156",
     "dob": "400925270",
     "phone": "(757)-276-4272",
     "cell": "(604)-684-2211",
     "SSN": "619-50-9894",
     "picture": "http://api.randomuser.me/portraits/men/41.jpg"
   },
   "seed": "493ddc906f743ad",
   "version": "0.4"
 }, {
   "user": {
     "gender": "male",
     "name": {
       "title": "mr",
       "first": "vernon",
       "last": "bailey"
     },
     "location": {
       "street": "8292 w ann rd",
       "city": "grand prairie",
       "state": "alaska",
       "zip": "70518"
     },
     "email": "vernon.bailey78@example.com",
     "username": "yellowrabbit445",
     "password": "postman",
     "salt": "2URSuWqr",
     "md5": "af65c0969e4a3a0d8b77bd0806563727",
     "sha1": "192476e871440c160b6035572f4f2cc1bd27797c",
     "sha256": "8510ab5f70fb842d256778c591ee2d99eded26f3458edd108dc59ddeb418b1d5",
     "registered": "1194957164",
     "dob": "230817417",
     "phone": "(478)-312-6215",
     "cell": "(835)-570-1848",
     "SSN": "614-57-7105",
     "picture": "http://api.randomuser.me/portraits/men/31.jpg"
   },
   "seed": "4c9e73f4d59dbdb",
   "version": "0.4"
 }, {
   "user": {
     "gender": "male",
     "name": {
       "title": "mr",
       "first": "gabriel",
       "last": "shelton"
     },
     "location": {
       "street": "3560 w ann rd",
       "city": "lancaster",
       "state": "south carolina",
       "zip": "85570"
     },
     "email": "gabriel.shelton31@example.com",
     "username": "whitemouse622",
     "password": "gaymen",
     "salt": "CBu01JwP",
     "md5": "7f93bdd0052b93786cc70a7d93bd8079",
     "sha1": "7b7a67cfd6b6dc6f403b7443615abc6ad080aa5f",
     "sha256": "5f0361f853c27dfaed09e0830e24ba560088cbcc21b30ce68d2b9801525aac96",
     "registered": "1287513839",
     "dob": "362408973",
     "phone": "(811)-295-5596",
     "cell": "(193)-406-8587",
     "SSN": "930-99-8014",
     "picture": "http://api.randomuser.me/portraits/men/35.jpg"
   },
   "seed": "e72a0693d12d1f9",
   "version": "0.4"
 }, {
   "user": {
     "gender": "female",
     "name": {
       "title": "miss",
       "first": "robin",
       "last": "stevens"
     },
     "location": {
       "street": "2610 red saturn dr",
       "city": "yakima",
       "state": "virginia",
       "zip": "48738"
     },
     "email": "robin.stevens97@example.com",
     "username": "beautifulostrich654",
     "password": "reds",
     "salt": "ys6sR9jv",
     "md5": "295d3ab0a0b2983e96dab6991a150130",
     "sha1": "c605de8629efd6102abadfb220499e66aec92f3f",
     "sha256": "aecaa97d1da57fd4fdc078ab6ed44fa08066fe776ee7652bbe2541b0e640aebd",
     "registered": "1366955591",
     "dob": "11128665",
     "phone": "(759)-966-1652",
     "cell": "(610)-562-6256",
     "SSN": "837-96-6706",
     "picture": "http://api.randomuser.me/portraits/women/39.jpg"
   },
   "seed": "cebae7dfddc67d8",
   "version": "0.4"
 }, {
   "user": {
     "gender": "female",
     "name": {
       "title": "miss",
       "first": "elizabeth",
       "last": "collins"
     },
     "location": {
       "street": "6129 marrow rd",
       "city": "magna",
       "state": "alabama",
       "zip": "60978"
     },
     "email": "elizabeth.collins87@example.com",
     "username": "heavyelephant873",
     "password": "viking",
     "salt": "UkahHPhk",
     "md5": "62f14fe3f2e2e2a1bcd9479b96e5c393",
     "sha1": "7417f2073de8dbe9797c0374e0c93f32d52dc40c",
     "sha256": "607027f5e5ae7f288a73406484492ef5625c8ab0b16d6ca0426bba2c1694ef49",
     "registered": "1191801506",
     "dob": "171433405",
     "phone": "(854)-230-2615",
     "cell": "(994)-534-2668",
     "SSN": "152-40-6759",
     "picture": "http://api.randomuser.me/portraits/women/95.jpg"
   },
   "seed": "65b30ac4c186a29",
   "version": "0.4"
 }, {
   "user": {
     "gender": "female",
     "name": {
       "title": "mrs",
       "first": "lillian",
       "last": "castro"
     },
     "location": {
       "street": "8542 oak lawn ave",
       "city": "washington d.c.",
       "state": "wisconsin",
       "zip": "75824"
     },
     "email": "lillian.castro25@example.com",
     "username": "redfrog221",
     "password": "access14",
     "salt": "NXFgaWYJ",
     "md5": "ca1ed7852bc0b96b002166fe3dac8095",
     "sha1": "0c7d4772df3c82861d69a403a4c21091797b017e",
     "sha256": "8c3b39f10636a212b342d4b429616b049ce584e762742570850e3ef55d683716",
     "registered": "977201276",
     "dob": "274285413",
     "phone": "(707)-887-3199",
     "cell": "(706)-656-4570",
     "SSN": "258-93-6659",
     "picture": "http://api.randomuser.me/portraits/women/64.jpg"
   },
   "seed": "746d1a99d917616",
   "version": "0.4"
 }, {
   "user": {
     "gender": "female",
     "name": {
       "title": "ms",
       "first": "claudia",
       "last": "barrett"
     },
     "location": {
       "street": "5986 auerbach ave",
       "city": "denver",
       "state": "north carolina",
       "zip": "51686"
     },
     "email": "claudia.barrett64@example.com",
     "username": "whiteduck405",
     "password": "blunt",
     "salt": "3beb0rAj",
     "md5": "3411571bdc7afc158673eb361fc18596",
     "sha1": "11a4c719b3caf80f2f55b8617e76ca38aec71b5d",
     "sha256": "879da22b1d0db05733311656ea0371e058f9d6b1c755f2e3694ee1774a62d748",
     "registered": "947158720",
     "dob": "481282975",
     "phone": "(525)-475-6145",
     "cell": "(536)-690-6392",
     "SSN": "391-40-5553",
     "picture": "http://api.randomuser.me/portraits/women/86.jpg"
   },
   "seed": "5c3e4851831d809",
   "version": "0.4"
 }, {
   "user": {
     "gender": "female",
     "name": {
       "title": "ms",
       "first": "frances",
       "last": "fisher"
     },
     "location": {
       "street": "2652 copper falls ave",
       "city": "elko",
       "state": "delaware",
       "zip": "42326"
     },
     "email": "frances.fisher10@example.com",
     "username": "ticklishfish810",
     "password": "andrews",
     "salt": "qpjixPd1",
     "md5": "8e25c1f79ced532b455c4e80d6bdabfe",
     "sha1": "acbbd5c0e47d9830bb9d48a989f2a8c54c32b5be",
     "sha256": "33c8bf6244e4f96446ef750945b2d06b93e095dfa7493e2daba8b05ecf7ddb0c",
     "registered": "1209928375",
     "dob": "213909200",
     "phone": "(138)-177-3369",
     "cell": "(601)-581-1257",
     "SSN": "693-89-5256",
     "picture": "http://api.randomuser.me/portraits/women/35.jpg"
   },
   "seed": "1e364edbb454e19",
   "version": "0.4"
 }, {
   "user": {
     "gender": "male",
     "name": {
       "title": "mr",
       "first": "dale",
       "last": "black"
     },
     "location": {
       "street": "8346 abby park st",
       "city": "wichita falls",
       "state": "minnesota",
       "zip": "24150"
     },
     "email": "dale.black90@example.com",
     "username": "goldenladybug468",
     "password": "godfathe",
     "salt": "pwpOooBi",
     "md5": "66e709c7faa8dc51994609789bca02e7",
     "sha1": "950c32e6688fce4730043d576be1044e5ee19a12",
     "sha256": "c45f437ae11701d5cd1839932024ff46edc21bf5c183e6240f2b593e3765857b",
     "registered": "1119803391",
     "dob": "120666225",
     "phone": "(530)-726-3173",
     "cell": "(550)-184-6692",
     "SSN": "446-24-2029",
     "picture": "http://api.randomuser.me/portraits/men/60.jpg"
   },
   "seed": "ce033d215f314b6",
   "version": "0.4"
 }, {
   "user": {
     "gender": "male",
     "name": {
       "title": "mr",
       "first": "eddie",
       "last": "dean"
     },
     "location": {
       "street": "8403 crestview dr",
       "city": "the colony",
       "state": "new jersey",
       "zip": "34105"
     },
     "email": "eddie.dean61@example.com",
     "username": "greenswan875",
     "password": "english",
     "salt": "DKREma4U",
     "md5": "597b8d7caded893ec3e185803d63d5cf",
     "sha1": "565af5b44cfe5cf481e1232c356bf28da5f28470",
     "sha256": "d1a5c6a79bf4b8fb93635a41a1619a7a34db0403baf79e0a0c0ed106ced1cd52",
     "registered": "1363263135",
     "dob": "451760884",
     "phone": "(892)-835-6833",
     "cell": "(671)-928-8685",
     "SSN": "458-67-2198",
     "picture": "http://api.randomuser.me/portraits/men/52.jpg"
   },
   "seed": "928ca9fa6618e83",
   "version": "0.4"
 }, {
   "user": {
     "gender": "female",
     "name": {
       "title": "ms",
       "first": "carrie",
       "last": "jacobs"
     },
     "location": {
       "street": "4318 wayne rd",
       "city": "iowa park",
       "state": "indiana",
       "zip": "58700"
     },
     "email": "carrie.jacobs57@example.com",
     "username": "heavycat979",
     "password": "danger",
     "salt": "hrzCqDSd",
     "md5": "9f6afd15619dbceca229e4c922282b51",
     "sha1": "675d10454e4654b7b3a0b650237853b705b89140",
     "sha256": "961ef975d6f136c07e87be9f55e88ea291d4468bed35d8af9db821d8e062e588",
     "registered": "1152076031",
     "dob": "71292758",
     "phone": "(768)-367-9595",
     "cell": "(321)-210-7795",
     "SSN": "687-15-8153",
     "picture": "http://api.randomuser.me/portraits/women/37.jpg"
   },
   "seed": "d3958d57a2d73e9",
   "version": "0.4"
 }, {
   "user": {
     "gender": "female",
     "name": {
       "title": "mrs",
       "first": "jennie",
       "last": "weaver"
     },
     "location": {
       "street": "1443 glendale st",
       "city": "rockford",
       "state": "delaware",
       "zip": "91450"
     },
     "email": "jennie.weaver32@example.com",
     "username": "greensnake701",
     "password": "cooper",
     "salt": "qfr96Kb0",
     "md5": "877676fd66957e17c281f750f220d9e8",
     "sha1": "3d23b74876be8578f216b72e332dc8df76e0a33d",
     "sha256": "28d012d648cd16053e021d84299ba5064e18328f211e4ca89d7b46b2798dcf81",
     "registered": "1354870811",
     "dob": "118537855",
     "phone": "(310)-251-7689",
     "cell": "(178)-927-4545",
     "SSN": "337-55-4193",
     "picture": "http://api.randomuser.me/portraits/women/57.jpg"
   },
   "seed": "9852207842080ee",
   "version": "0.4"
 }, {
   "user": {
     "gender": "female",
     "name": {
       "title": "mrs",
       "first": "deann",
       "last": "mckinney"
     },
     "location": {
       "street": "7969 pepperridge way",
       "city": "henderson",
       "state": "wisconsin",
       "zip": "45548"
     },
     "email": "deann.mckinney31@example.com",
     "username": "biggoose425",
     "password": "passthie",
     "salt": "wkcGIjGe",
     "md5": "365ccb974d5fad22ff8cbd6a4e83bdb2",
     "sha1": "7fc1c46b4f37fa34e4d874936deded724f435164",
     "sha256": "7ac04b0b7ae631c6c12e74fed2507c8092345915b704d03e71834addaead3e80",
     "registered": "1323751989",
     "dob": "121470582",
     "phone": "(263)-720-9862",
     "cell": "(381)-594-7419",
     "SSN": "799-84-9164",
     "picture": "http://api.randomuser.me/portraits/women/11.jpg"
   },
   "seed": "9e3992161dd5bd1",
   "version": "0.4"
 }]
};
var initMap = function(geojson) {
  var osmb, circleLayer = new L.FeatureGroup(),
  circles = [],
  count = 0,
  markerLayer = new L.FeatureGroup(),
  markers = [],
  LeafIcon = L.icon({
    iconUrl: 'marker.png',
    iconSize: [25, 25],
    iconAnchor: [13, 25],
    popupAnchor: [0, -25]
  }),
  LeafStyle = {
    "color": "#ff7800",
    "weight": 2,
    "opacity": 0.65
  },
  ytor = L.geoJson(geojson, {
    style: LeafStyle,
    onEachFeature: function(f, l) {
      var popup = '<img src="' + json_users['results'][count].user.picture + '"><p><strong>' + json_users['results'][count].user.name.first + ' ' + json_users['results'][count].user.name.last + '</strong><br>@' + json_users['results'][count].user.username + '<br><h2>Tweets: ' + f.properties.height + '</h2></p>';
      l.bindPopup(popup);
      
      var marker = L.marker([f.properties.lonlat[1], f.properties.lonlat[0]], {
        icon: LeafIcon
      }).bindPopup(popup);
      
      markers.push(marker);
      
      var circle = L.circle([f.properties.lonlat[1], f.properties.lonlat[0]], f.properties.height / 4, {
        color: 'red',
        fillColor: f.properties.color,
        fillOpacity: 0.5
      }).bindPopup(popup);
      
      var dot = L.circle([f.properties.lonlat[1], f.properties.lonlat[0]], 1, LeafStyle);
      
      circles.push(circle);
      circles.push(dot);
      
      $(".info").append('<div>' + '<img src="' + json_users['results'][count].user.picture + '"><p>' + json_users['results'][count].user.name.first + ' ' + json_users['results'][count].user.name.last + '<br><small>Tweets: ' + f.properties.height + '</small></p></div>');
      count += 1;
   }
  });
  
  var map = L.map('map', {
    zoomControl: false
  });
  
  L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
  }).addTo(map);
  
  $('.controls a').click(function() {
    switch ($(this).attr('data-rel')) {
      case '1':
        if (!$(this).hasClass("clicked")) {
          $.each(markers, function() {
            this.addTo(markerLayer);
          });
          markerLayer.addTo(map);
        } else {
          map.removeLayer(markerLayer);
        }
        break;
      case '3':
        if (!$(this).hasClass("clicked")) {
          $.each(circles, function() {
            this.addTo(circleLayer);
          });
          circleLayer.addTo(map);
         } else {
           map.removeLayer(circleLayer);
         }
         break;
      case '2':
        if (!$(this).hasClass("clicked")) {
          ytor.addTo(map);
        } else {
          map.removeLayer(ytor);
        }
        break;
      case '4':
        if (!$(this).hasClass("clicked")) {
          osmb = new OSMBuildings(map).setData(geojson);
          osmb.setStyle({
            wallColor: 'rgb(250,250,250)',
            roofColor: 'rgb(150, 100, 150)',
            shadows: true
          });
        } else {
          map.removeLayer(osmb);
        }
        break;
    }
    $(this).toggleClass('clicked');
  });
  map.setView([55.989964032692356, 14.27011250105107], 16);
};

$(document).ready(function() {
  $.getJSON("neighbourhood.geojson", function(data) {
   initMap(data);
  });
});
